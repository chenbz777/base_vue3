<script setup>
import { ref, nextTick, onBeforeUnmount } from 'vue';
import config from '@/config';


const props = defineProps({
  src: {
    type: String,
    default: ''
  }
});

/**
 * 图片增强
 * 
 * 加载顺序: 加载中占位图 => 缩略图 => 原图
 * 
 * 注意事项:
 *   - 根据业务完善缩略图的生成方式
 *   - 根据业务完善原图的生成方式
 */

const imageRef = ref(null);

const currentSrc = ref('');

const loadingImage = 'data:image/gif;base64,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';

const errorImage = 'data:image/png;base64,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';

let io = null;

function getOriginalUrl() {
  if (!props.src) {
    return '';
  }

  if (props.src.includes('http')) {
    return props.src;
  }

  if (props.src.includes('data:image')) {
    return props.src;
  }

  return `${config.request.baseURL}${props.src}`;
}


function getThumbnailUrl() {
  if (!props.src) {
    return '';
  }

  if (props.src.includes('http')) {
    return props.src;
  }

  if (props.src.includes('data:image')) {
    return props.src;
  }

  return `${config.request.baseURL}${props.src}`;
}

function loadOriginal() {
  const url = getOriginalUrl();

  const image = new Image();

  image.src = url;

  image.onload = () => {
    currentSrc.value = url;
  };

  image.onerror = () => {
    currentSrc.value = errorImage;
  };
}


function loadThumbnail() {
  const url = getThumbnailUrl();

  const image = new Image();

  image.src = url;

  image.onload = () => {
    currentSrc.value = url;

    // 预加载原图
    loadOriginal();
  };

  image.onerror = () => {
    currentSrc.value = errorImage;
  };
}

function lazyImage(elm) {
  io = new IntersectionObserver(([entry]) => {
    if (entry.isIntersecting) {
      // 加载缩略图
      loadThumbnail();

      io.disconnect();
    }
  });

  io.observe(elm);
}

function loadLoading() {
  const target = imageRef.value;

  if (!target) {
    return;
  }

  /**
   * 设置图片的属性
   */

  // 设置图片缩略图
  target.setAttribute('data-thumbnail', getThumbnailUrl());

  // 设置图片原图
  target.setAttribute('data-original', getOriginalUrl());

  const image = new Image();

  image.src = loadingImage;

  image.onload = () => {
    currentSrc.value = loadingImage;

    lazyImage(target);
  };

  image.onerror = () => {
    currentSrc.value = errorImage;
  };
}

nextTick(() => {
  loadLoading();
});

onBeforeUnmount(() => {
  if (io) {
    io.disconnect();
    io = null;
  }
});
</script>

<template>
  <img :src="currentSrc" class="image-enhance" ref="imageRef" />
</template>

<style scoped>
.image-enhance {
  display: block;
  width: 100%;
  height: auto;
  object-fit: contain;
}
</style>